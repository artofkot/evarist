{% extends "layout.html" %}
{% block head %}
   <title></title>
{% endblock %}
{% block body %}


  <div class="row">
    <div class="col-md-6 col-md-offset-2">
      <a href="{{url_for('workflow.problem_set',problem_set_slug=problem_set_slug)}}">Обратно к листку</a>
    </div>
  </div>
  <div style='height:20px'></div>

  <hr>

  <div class="row">
    <div class="col-md-6 col-md-offset-2">
      <div>
        <p>
        Задача {{problem.get('problem_number')}}.
        
        {{problem['text']|safe}}
        </p>
      </div>
    </div>
  </div>  


  <div class="row">
    
    <div class="col-md-5 col-md-offset-2">
      {% if "username" in session %}  
        

        <strong class="text-center"> Ваше решение </strong>
        {% if not g.solution_written %}
          <form action=" {{url_for('workflow.problem', problem_set_slug=problem_set_slug, prob_id=problem['_id'])}}" method="post">
            
            {{ solution_form.hidden_tag() }}
            <div class="form-group" >

              <label for="solution"> </label>
              <textarea class="form-control" rows="5"  name='solution'></textarea>

            </div>
            <button type="submit" class="btn btn-default">Отправить</button>
          </form>
        {% elif g.solution_written%}
          
          {% if problem['solution']['is_right'] %}
            <h3><strong> Correct!</strong></h3>
            <div class="blog-post" >
              <pre style="background-color:lightgreen">{{ problem['solution']['text'] }}</pre>
            </div>
          {%else %}
            <div class="blog-post">
              <pre>{{ problem['solution']['text'] }}</pre>
            </div>
          {%endif%}
          <p>{{problem['solution'].get('upvotes')}} за</p>
          <p>{{problem['solution'].get('downvotes')}} против</p>
          
          <button class="btn btn-default" type="button" data-toggle="collapse" data-target="#collapsId" aria-expanded="false" aria-controls="collapsId">
            Исправить решение
          </button>
          <div class="collapse" id="collapsId">
            <form action=" {{url_for('workflow.problem', problem_set_slug=problem_set_slug, prob_id=problem['_id'])}}" method="post">
              <div class="form-group" style='width: 370px'>
                {{ edit_solution_form.hidden_tag() }}
                <label for="edit_text">Исправьте решение здесь: </label>
                <textarea class="form-control" rows="2"  name='edited_solution'>{{problem['solution']['text']}}  
                </textarea>
                
                <div class="checkbox" style='background-color:red'>
                  <label >
                    <input type="checkbox" name='delete_solution'>удалить это решение, навсегда
                  </label>
                </div>
              </div>
              <button type="submit" class="btn btn-default">Отправить</button>
            </form>
          </div>

          <form action=" {{url_for('workflow.problem', problem_set_slug=problem_set_slug, prob_id=problem['_id'], sol_id=problem['solution']['_id'])}}" method="post">
            <div class="form-group" >

              {{ solution_comment_form.hidden_tag() }}
              <label for="feedback_to_solution">  <strong> Комментировать: </strong> </label>
              <textarea class="form-control" rows="2"  name='feedback_to_solution'></textarea>
              

            </div>
            <button type="submit" class="btn btn-default">Отправить</button>
          </form>

          {% for post in problem['solution']['discussion'] | reverse %}
            <div class="blog-post">
              <p class="blog-post-meta">{{post['date'].day}}/{{post['date'].month}}/{{post['date'].year}} by {{post['author']}}</p>
              <pre>{{ post['text'] }}</pre>
            </div>
          {% endfor %}
        {%endif%}
        
        {%if g.other_solutions%}
          {%for solution in g.other_solutions%}
            <hr>
            <div style='height:50px'>
            </div>


            {% if solution['is_right'] %}
              <div class="blog-post">
                <p class="blog-post-meta"><strong>Решение от {{solution['author']}}.</strong> 
                <strong style='color:green'> Проверено, правильное.</strong> </p>
                <pre>{{ solution['text'] }}</pre>
              </div>
            {%else%}
              <div class="blog-post">
                <p class="blog-post-meta"><strong>Решение от {{solution['author']}}.</strong> 
                </p>
                <pre>{{ solution['text'] }}</pre>
              </div>
            {%endif%}
            
            <div class='row'>
              <div class="col-md-4 col-md-offset-1">
                <p>{{solution.get('upvotes')}} за</p>
                <p>{{solution.get('downvotes')}} против</p>
              </div>
              <div class="col-md-4 col-md-offset-2">
                {%if session['email'] not in solution.get('emails_voted')%}
                  <form action=" {{url_for('workflow.problem', problem_set_slug=problem_set_slug, prob_id=problem['_id'], sol_id=solution['_id'])}}" method="post">
                    
                    {{ vote_form.hidden_tag() }}
                    
                      <div class="form-group" >
                        <div class="radio">
                          <label>
                            <input type="radio" name="vote" id="optionsRadios1" value="upvote" >
                            за
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="vote" id="optionsRadios2" value="downvote">
                            против
                          </label>
                        </div>
                      </div>
                      <button type="submit" class="btn btn-xs btn-default">Проголосовать</button>
                    
                    <!--  Template for disabled and checked radio button

                    <div class="radio disabled">
                      <label>
                        <input type="radio" name="test" id="optionsRadios3" value="option3" disabled checked>
                        Option three is disabled
                      </label>
                    </div> -->
                    
                  </form>
                {%else%}
                  <p><strong style='color:green'> Вы уже проголосовали.</strong></p>
                {%endif%}
              </div>
            </div>
            
            


            <form action=" {{url_for('workflow.problem', problem_set_slug=problem_set_slug, prob_id=problem['_id'], sol_id=solution['_id'])}}" method="post">
              <div class="form-group" >
                {{ solution_comment_form.hidden_tag() }}
                <label for="feedback_to_solution">  <strong> Комментировать: </strong> </label>
                <textarea class="form-control" rows="2"  name='feedback_to_solution'></textarea>
              </div>
              <button type="submit" class="btn btn-default">Отправить</button>
            </form>
            
            <div style='height:5px'></div>
            
            {% if solution.get('discussion')%}
              <button class="btn btn-xs btn-default" type="button" data-toggle="collapse" data-target="#collapseId{{loop.index}}" aria-expanded="true" aria-controls="collapseId{{loop.index}}">
                спрятать комментарии
              </button>
              <div class="collapse in" aria-expanded="true" id="collapseId{{loop.index}}">
                {% for post in solution['discussion'] | reverse %}
                  <div class="blog-post">
                      <p class="blog-post-meta">{{post['date'].day}}/{{post['date'].month}}/{{post['date'].year}} by {{post['author']}}</p>
                      <pre>{{ post['text'] }}</pre>
                  </div>
                {% endfor %}
              </div>
            {% endif %}

          {%endfor%}
        {%endif%}
  
      {% else %}
      <p>
        Чтобы послать решение задачи на проверку, или задать вопрос по условию, <a href="{{url_for('user.login')}}">войдите</a>. 
      </p>
      {% endif %}
    </div>


    <div class="col-md-3 col-md-offset-2">
      <strong> Вопросы по условию </strong>
      
      {% if "username" in session %}
      <p>
        <form action=" {{url_for('workflow.problem', problem_set_slug=problem_set_slug, prob_id=problem['_id'])}}" method="post">
          <div class="form-group" >

            {{ general_comment_form.hidden_tag() }}
            <!-- <label for="text"> </label> -->
            <textarea class="form-control" rows="2"  name='text'></textarea>

          </div>
          <button type="submit" class="btn btn-default">Отправить</button>
        </form>
      </p>
      {% endif %}


      {% for post in problem.get('general_discussion') | reverse %}
        <div class="blog-post">
          <p class="blog-post-meta">{{post['date'].day}}/{{post['date'].month}}/{{post['date'].year}} by {{post['author']}}</p>
          <pre>{{ post['text'] }}</pre>
        </div>
      {% endfor %}
      
    </div>


  </div>  



{% endblock %}