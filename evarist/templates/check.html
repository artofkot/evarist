{% import 'macros/solutions.html' as solution_macros %}
{% import 'macros/forms.html' as form_macros %}


{% extends "layout.html" %}
{% block head %}
{% endblock %}
{% block body %}

  <div class="row">
    <div class="col-md-6 col-md-offset-3">
      
      <h3>Это решения, которые можно проверить, то есть проголосовать за "верно" или "неверно", и написать отзыв при необходимости (например если решение недоведено). Вы можете проверять только уже решенные вами задачи. </h3>
      <hr>

      {%for solution in solutions | reverse %}
        <!-- solutions text, and the name of problem set -->
        <div>
          <p>
            <em>{{solution.get('problem_set')|safe}}</em> <br>
            {{solution.get('problem_text')|safe}}
          </p>
        </div>

        <!-- solution -->
        {{solution_macros.solution(solution=solution)}}

        <!-- votes + form for voting-->
        <div class='row'>
          <!-- votes -->
          <div class="col-md-4 col-md-offset-1">
            {{solution_macros.display_votes(solution)}}
          </div>

          <!-- vote form -->
          <div class="col-md-4 col-md-offset-2">
          {%if session['email'] not in solution.get('emails_voted')%}
            <form action="{{request.path}}?sol_id={{solution['_id']}}" method="post">
              {{ vote_form.hidden_tag() }}
              {{ form_macros.vote_for_solution_form() }}
            </form>
          {%else%}
            <p><strong style='color:green'> Вы уже проголосовали.</strong></p>
          {%endif%}
          </div>
        </div>

        <!-- comment form -->
        <form action=" {{url_for('.check', sol_id=solution['_id'])}}" method="post">
          <div class="form-group" >
            {{ solution_comment_form.hidden_tag() }}
            <label for="feedback_to_solution">  <strong> Комментировать: </strong> </label>
            <textarea class="form-control" rows="2"  name='feedback_to_solution'></textarea>
          </div>
          <button type="submit" class="btn btn-default">Отправить</button>
        </form>

        <div style='height:5px'></div>

        <!-- displaying existing comments -->
        {% if solution.get('discussion')%}
          <button class="btn btn-xs btn-default" type="button" data-toggle="collapse" data-target="#collapse_Id_{{loop.index}}" aria-expanded="true" aria-controls="collapse_Id_{{loop.index}}">
            спрятать комментарии
          </button>
          <div class="collapse in" aria-expanded="true" id="collapse_Id_{{loop.index}}">
            {% for post in solution['discussion'] | reverse %}
              <div class="blog-post">
                  <p class="blog-post-meta">{{post['date'].day}}/{{post['date'].month}}/{{post['date'].year}} by {{post['author']}}</p>
                  <pre>{{ post['text'] }}</pre>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <div style='height:50px'>
        </div>
        <hr>
      {%endfor%}

    </div>
  </div>

{% endblock %}